<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3.0//EN" "html.dtd">
<HTML>
<HEAD><TITLE>
Hercules Version 3: Installation and Operation</TITLE>
<LINK REL=STYLESHEET TYPE="text/css" HREF="hercules.css">
</HEAD>
<BODY BGCOLOR="#ffffcc" TEXT="#000000" LINK="#0000A0"
      VLINK="#008040" ALINK="#000000">

<h1>Hercules Version 3: Installation and Operation</h1>

<p><hr>

<h2>Contents</h2>
<blockquote>
    <p>
        <a href="#install">Installation Procedure</a>
        <ul>
            <li><a href="#instsource">- Building from source</a>
            <li><a href="#instbinary">- Pre-built binaries</a>
        </ul>
    </p>
    <p>
        <a href="#config">Configuration Procedure</a>
    </p>
    <p>
        <a href="#dasd">Creating DASD volumes</a>
    </p>
    <p>
        <a href="#operating">Operating Procedure</a>
        <ul>
            <li><a href="#commands">Panel commands</a>
            <li><a href="#RCFILE">The .RC &nbsp;("run commands")&nbsp; file</a>
            <li><a href="#HAO">HAO &nbsp;("Hercules Automatic Operator")</a>
        </ul>
    </p>

    <p>
        <a href="#support">Technical Support</a>
    </p>
</blockquote>

<p><hr><a name="install"></a>
<h2>Installation Procedure</h2>
<a name="instsource"></a>
<h3>Building from source - Windows with Cygwin</h3>
<p>
For building the Cygwin version of Hercules on Windows, Volker Bandke
has instructions on his "<b>Building Hercules for Windows</b>" web page at
<a href="http://www.bsp-gmbh.com/hercules/herc_w32_2.html">http://www.bsp-gmbh.com/hercules/herc_w32_2.html</a>.
</p>

<h3>Building from source - Windows (without Cygwin)</h3>
<p>
For building the MSVC version of Hercules on Windows (a version of
Hercules that does <i>not</i> require Cygwin), Fish has instructions on his
"<b>MSVC Hercules Build Instructions</b>" web page at
<a href="http://www.softdevlabs.com/Hercules/hercules-msvc-build.html">http://www.softdevlabs.com/Hercules/hercules-msvc-build.html</a>.
</p>

<h3>Building from source - Linux and Mac OS X</h3>
<ol>
<li>Download the distribution file
<a href="http://www.hercules-390.org/hercules-3.04.tar.gz">hercules-3.04.tar.gz</a>
<br><em>Note:</em> By downloading this file you agree to the terms
    of the <a href="herclic.html">Q Public Licence</a>.
<p>
<li>Use these commands to unzip the distribution file:
<pre>tar xvzf ../hercules-3.04.tar.gz
cd hercules-3.04</pre>

<li>Verify you have all of the correct versions of all of the
required packages installed:

<p><code>./util/cvslvlck</code>

<p><li>Configure Hercules for your system:

<p><code>./configure</code>

<p>By default, the configure script will attempt to guess appropriate
      compiler optimization flags for your system.  If its guesses
      turn out to be wrong, you can disable all optimization by
      passing the <code>--disable-optimization</code> option to
      configure, or specify your own optimization flags with
      <code>--enable-optimization=FLAGS</code>

<p>For additional configuration options, run: <code>./configure
          --help</code>

<p><li>Build the executables: <p><code>make</code>

<p><li>Install the programs: as root: <p><code>make install</code>
</ol>

<p>
<em>Important:</em>
You must use at least version 2.95 of the gcc compiler and the glibc2 library.
Refer to the <a href="hercfaq.html#3.04">
Hercules Frequently-Asked Questions</a> page for required
compiler and other software levels.

<a name="instbinary"></a>
<h3>Installing prebuilt RPMs:</h3>
<ol>
<li>Download the RPM file you want:
<ul>
<li><a href="http://www.hercules-390.org/hercules-3.04-1.i686.rpm">hercules-3.04-1.i686.rpm</a>: Intel
</ul>
<li>Install the RPM:
<br><code>rpm -Uvh</code> <i>RPMfile</i>
</ol>
<p>
This will leave the Hercules executables in /usr/bin and the dynamic
libraries in /usr/lib and /usr/lib/hercules, where you can run them
from anywhere. Sample configuration files will be placed in /etc/hercules,
and the IPLable card deck for the ZZSA standalone utility will be placed in
/var/share/hercules.

<h3>Installing Debian packages:</h3>
<p>
Debian packages are available for "woody" and later releases.

<ul>
<li>Using apt: <code>apt-get install hercules</code>
<li>Manually with dpkg:
  <ol>
    <li>Download a <a href="http://packages.debian.org/hercules">.deb
        package</a>
    <li><code>dpkg -i</code> <i>DEB</i>
  </ol>
</ul>
</p>

<h3>Installing on Gentoo Linux:</h3>
<p>Hercules is installed like any other Gentoo package: do <code>emerge
sync</code> if you haven't done it lately, then <code>emerge
hercules</code>.</p>
<p>Do not try to override the optimization flags automatically selected by
<code>configure</code>. Hercules stresses the gcc optimizer, and will break
in subtle ways if the wrong optimization settings are used.</p>

<h3>Installing on Mac OS X:</h3>

<ol>
<li>Download the compressed disk image: <a
href="http://www.hercules-390.org/hercules-3.04-panther.dmg">hercules-3.04-panther.dmg</a> if you're
running OS X version 10.3, or <a
href="http://www.hercules-390.org/hercules-3.04-tiger.dmg">hercules-3.04-tiger.dmg</a> if you're running
version 10.4 or later.
<li>Mount the image by double-clicking on it in the Finder.
Your web browser may have done that for you already.
<li>Installation and use instructions are in the
file <code>OS&nbsp;X&nbsp;ReadMe.rtf</code>.
<li>If you want to use CTC networking on your Hercules system, you will need
to install the supplied Tunnel driver. Note that, at this writing, the
Panther version of the driver works fine, but the Tiger version will hang
at Hercules shutdown, and you must reboot in order to clear the problem.
Unfortunately, the Panther driver will not work on Tiger at all.
</ol>

<h3>Installing on Windows (without Cygwin):</h3>
<ol>
<li>Download the <a
href="http://www.hercules-390.org/hercules-3.04-native.exe">self-extracting
Windows archive</a> or the <a
href="http://www.hercules-390.org/hercules-3.04-native.msi">Windows
Installer package</a>.
<li>If you downloaded the self-extracting archive, simply execute it to
install Hercules on your system. If you downloaded the Windows Installer
package, use the Windows Installer to install Hercules. The Windows
Installer is included in Windows XP. It may already be on your older Windows
system, depending on what other software you've installed. If it is,
double-clicking on the Hercules package file will install Hercules. If not,
you can download the Windows Installer for Windows NT and 2000 by following
<a href="http://www.microsoft.com/downloads/release.asp?releaseid=32832">this
link</a>, or the Windows Installer for Windows 98 and ME by following
<a href="http://www.microsoft.com/downloads/release.asp?releaseid=32831">this
link</a>.
<li>You will probably also want to install Fish's Hercules GUI for Windows.
You can get it from <a
href="http://www.softdevlabs.com/Hercules/hercgui-index.html">
http://www.softdevlabs.com/Hercules/hercgui-index.html</a>.
</ol>

<h3>Installing on Windows with Cygwin:</h3>
<ol>
<li>You must first install the Cygwin package.
Download the 'setup.exe' program from <a href="http://www.cygwin.com">the Cygwin
site</a>, and run it. (Right-click on the
<img src="http://www.cygwin.com/cygwin-icon.gif" border=0 alt="Cygwin!"> icon
labeled "<a href="http://www.cygwin.com/setup.exe">Install or update now!
(using setup.exe)</a>" and select "Save Target As..." and then run it after
it's been downloaded) If it's not preselected for you,
select the libintl-2 package when you're presented with a list of packages
to install. (NOTE: Hercules version 3.04 was built with version 1.5.15
of Cygwin, and may not work with other versions, as the
Cygwin library tends to have subtle incompatibilities from version
to version that Hercules seems to stress.)

<li>Download the self-extracting Windows archive:
<ul>
<li><a href="http://www.hercules-390.org/hercules-3.04-cygwin-p4.exe">hercules-3.04-cygwin-p4.exe</a>:
Pentium 4 version
<li><a href="http://www.hercules-390.org/hercules-3.04-cygwin-i686.exe">hercules-3.04-cygwin-i686.exe</a>:
Pentium Pro/Pentium II and above version
<li><a href="http://www.hercules-390.org/hercules-3.04-cygwin-i586.exe">hercules-3.04-cygwin-i586.exe</a>:
Pentium version
</ul>
<li>Run one of the above self-extracting archives to install the Hercules
executables on your system. Also please note that Hercules has several file
paths compiled into the code, and so it is best to install the package
into the default directories unless you really know what you're doing.
</ol>

<p><hr><a name="config"></a>
<h2>Configuration Procedure</h2>
<p>
You will need to amend the configuration file
<em><b>hercules.cnf</b></em> to reflect your device layout and intended
mode of operation (S/370, ESA/390, or z/Architecture).
See the <a href="hercconf.html">Hercules Configuration File</a> page for
a complete description.

<p><hr><a name="dasd"></a>
<h2>Creating DASD volumes</h2>
<p>
The <a href="hercload.html">Creating Hercules DASD</a> page
describes various methods of creating and loading virtual DASD
volumes. The compressed CKD DASD support is described in <a
href="cckddasd.html">this page</a>.

<p><hr><a name="operating"></a>
<h2>Operating Procedure</h2>
<p class="warning">
<em>Note: If you intend to run any licensed software on your PC
using Hercules, it is your responsibility to ensure that you do not
violate the software vendor's licensing terms.</em>

<h4>Loading a standalone program or operating system</h4>
<p>
To start Hercules enter this command at the Unix shell prompt:
<blockquote><code><pre>
    hercules  [ -f <em>filename</em> ]
              [ -d ]
              [ -p <em>dyndir</em> ]  [[-l <em>dynmod</em> ] ... ]
              [ &gt; <em>logfile</em> ]
</pre></code>
</blockquote>
<p>
where:
<blockquote>
<dl>
        <dt><code><em>filename</em></code><p><dd>

            is the name of the configuration file.
            The default, if none is specified, is <b><em>hercules.cnf</em></b>.
            The default may be overridden via the <code>HERCULES_CNF</code>
            environment variable.
        <p>
        <dt><code><em>-d</em></code><p><dd>

            specifies that Hercules is to be run in 'daemon' mode,
            wherein it runs invisibly with no attached console.
        <p>
        <dt><code><em>dyndir</em></code><p><dd>

            is the directory from which dynamic modules are to be loaded.
            The default depends on the host platform on which Hercules
            is being run. This option overrides the default.
        <p>
        <dt><code><em>dynmod</em></code><p><dd>

            is the name of an additional dynamic module to be loaded
            at startup. More than one additional module may be specified,
            although each must be preceded with the <code>-l</code>
            option specifier.
        <p>
        <dt><code><em>logfile</em></code><p><dd>

            is an optional log file which will receive a copy of
            all messages displayed on the control panel
        <p>
</dl>
</blockquote>

<p>
Next connect a tn3270 client to the console port (normally port 3270).
The client will be connected to the first 3270 device address specified
in the configuration file (this should be the master console address).
If your master console is a 1052 or 3215, connect a telnet client
instead of a tn3270 client.

<p>
Now you can enter an ipl command from the control panel.

<p><br>
<hr width="50%">

<a name="commands">
<h4>Panel commands</h4>
<p>
The following is what is displayed on the Hercules harware console (HMC)
in response to the '?' command being entered. Please note that it may not
be completely accurate or up-to-date. Please enter the '?' command for
yourself for a more complete, accurate and up-to-date list of supported
panel commands.
<p>
<pre>

    Command      Description...
    -------      -----------------------------------------------
    ?            list all commands
    help         command specific help

    *            (log comment to syslog)

    hst          history of commands
    log          direct log output
    logopt       change log options 
    version      display version information

    quit         terminate the emulator
    exit         (synonym for 'quit')

    cpu          define target cpu for panel display and commands

    start        start CPU (or printer device if argument given)
    stop         stop CPU (or printer device if argument given)

    startall     start all CPU's
    stopall      stop all CPU's

    cf           configure CPU online or offline
    cfall        configure all CPU's online or offline

    .reply       scp command
    !message     scp priority messsage
    ssd          Signal Shutdown

    ptt          display pthread trace

    i            generate I/O attention interrupt for device
    ext          generate external interrupt
    restart      generate restart interrupt
    store        store CPU status at absolute zero
    archmode     set architecture mode
    loadparm     set IPL parameter

    ipl          IPL Normal from device xxxx
    iplc         IPL Clear from device xxxx
    sysreset     Issue SYSTEM Reset manual operation
    sysclear     Issue SYSTEM Clear Reset manual operation

    psw          display program status word
    gpr          display general purpose registers
    fpr          display floating point registers
    fpc          display floating point control register
    cr           display control registers
    ar           display access registers
    pr           display prefix register
    clocks       display tod clkc and cpu timer
    ipending     display pending interrupts
    ds           display subchannel
    r            display or alter real storage
    v            display or alter virtual storage
    u            disassemble storage
    devtmax      display or set max device threads
    k            display cckd internal trace

    attach       configure device
    detach       remove device
    define       rename device
    devinit      reinitialize device
    devlist      list all devices

    scsimount    automatic SCSI tape mounts

    sh           shell command
    cache        cache command
    cckd         cckd command
    shrd         shrd command
    quiet        toggle automatic refresh of panel display data

    b            set breakpoint
    b-           delete breakpoint
    g            turn off instruction stepping and start CPU

    ostailor     trace program interrupts
    pgmtrace     trace program interrupts
    savecore     save a core image to file
    loadcore     load a core image file
    loadtext     load a text deck file

    ldmod        load a module
    rmmod        delete a module
    lsmod        list dynamic modules
    lsdep        list module dependencies

    iodelay      display or set I/O delay value
    tt32stats    display CTCI-W32 statistics
    toddrag      display or set TOD clock drag factor
    panrate      display or set rate at which console refreshes
    syncio       display syncio devices statistics
    maxrates     display maximum observed MIPS/SIOS rate for the
                 defined interval or define a new reporting interval

    script       Run a sequence of panel commands contained in a file
    cscript      Cancels a running script thread

    evm          ECPS:VM Commands (Deprecated)
    ecpsvm       ECPS:VM Commands

    aea          Display AEA tables
    aia          Display AIA fields
    tlb          Display TLB tables

    sizeof       Display size of structures

    suspend      Suspend hercules
    resume       Resume hercules

    sf+          add shadow file
    sf-          delete shadow file
    sf=          rename shadow file
    sfc          compress shadow files
    sfd          display shadow file stats

    t{+/-}       turn instruction tracing on/off
    s{+/-}       turn instruction stepping on/off
    t{+/-}dev    turn CCW tracing on/off
    s{+/-}dev    turn CCW stepping on/off
    t{+/-}CKD    turn CKD_KEY tracing on/off
    f{+/-}adr    mark frames unusable/usable

</pre>
<p>
The <em>ipl</em> command may also be used to perform a load from cdrom or
server.  For example if a standard SuSE S/390 Linux distribution CD is loaded
and mounted on /cdrom for example, this cdrom may then be ipl-ed by:
<em>ipl /cdrom/suse.ins</em>
<p>
The <em>attach</em> and <em>detach</em> commands are used to dynamically
add or remove devices from the configuration,
and the <em>define</em> command can be used to alter the device number
of an existing device.
<p>
The <em>devinit</em> command can be used to reopen an existing device.
The <em>args</em> (if specified) override the arguments
specified in the configuration file for this device.
The device type cannot be changed and must not be specified.
This command can be used to rewind a tape, to mount a new tape or
disk image file on an existing device, to load a new card deck
into a reader, or to close and reopen a printer or punch device.
<p>
In single-step mode, pressing the enter key will advance to the
next instruction.
<p>
There is also an alternate semi-graphical control panel.  Press Esc to
switch between the command line format and the semi-graphical format.
Press ? to obtain help in either control panel.
<p>
Some commands also offer additional help information regarding their syntax,
etc. Enter&nbsp; "<tt>help <i>&lt;command name&gt;</i></tt>" &nbsp; to display
this additional help information. (Note: not every command supports help)

<p>
<hr width="50%">

<a name="RCFILE">
<h4>The &nbsp;hercules.rc &nbsp;(run-commands)&nbsp; file</h4>
</a>
<p>
Hercules also supports the ability to automatically execute panel commands
upon startup via the 'run-commands' file. If the run-commands file
is found to exist when Hercules starts, each line contained within it is
read and interpreted as a panel command exactly as if the command were
entered from the HMC system console.
<p>
The default filename for the run-commands file is "hercules.rc", but may be
overridden by setting the "<tt><b>HERCULES_RC</b></tt>" environment variable to the
desired filename.
<p>
Except for the 'pause' command (see paragraph further below), each command
read from the run-commands file is logged to the console preceded by a '> '
(greater-than sign) character so you can easily distinguish between panel
commands entered from the keyboard from those entered via the .rc file.
<p>
Lines starting with '<tt>#</tt>' are treated as "silent comments" and are
thus not logged to the console. Line starting with '<tt>*</tt>' however are
treated as "loud comments" and <i>will</i> be logged.
<p>
In addition to being able to execute any valid panel command (including the
'sh' shell command) via the run-commands file, an additional
'<tt><b>pause <i>nnn</i></b></tt>' command is supported in order to introduce
a brief delay before reading and processing the next line in the file. The
value <tt><i>nnn</i></tt> can be any number from 1 to 999 and specifies the
number of seconds to delay before reading the next line. Creative use of the
run-commands file can completely automate Hercules startup.
<p>
<hr width="50%">

<a name="HAO">
<h4>The "Hercules Automatic Operator" (HAO) Facility</h4>
</a>
<p>
The Hercules Automatic Operator (HAO) feature is a facility that allows one
to automatically issue panel commands in response to certain messages being
issued.
<p>
To use the Hercules Automatic Operator facility, one first defines a "rule"
consisting of a "target" and an associated "command". The "target" is just
a regular expression pattern used to match against the text of the various
messages that Hercules issues as it runs. Whenever a match is found, the
rule "fires" and its associated command is automatically issued.
<p>
The Hercules Automatic Operator facility is <i>only</i> for those messages
issued <i>by Hercules</i> to its HMC (hardware console). It <i>cannot</i>
be used for whatever messages the guest operating system may issue to any
of its terminals. It is only a <i>Hercules</i> automatic operator and
<i>not</i> a "VSE", "MVS", "VM", etc, automatic operator.
<p>
For more information regarding Hercules Automatic Operator facility
(including brief usage instructions) please refer to the
<code><u>README.HAO</u></code>
document included as part of the source-code distribution.
<p>

<p><hr><a name="support"></a>
<h2>Technical Support</h2>

<P>
For technical support, please refer our <a href="hercsupp.html">Technical Support</a> web page.
</P>

<p><center><hr width=15% noshade><p>
<a href="index.html"><img src="images/back.gif" border=0 alt="back"></a>
</center>
<p class="lastupd">Last updated $Date$ $Revision$</p>
</BODY>
</HTML>
